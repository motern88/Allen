import{ElIcon as e,ElMessage as t,ElTooltip as n,Fragment as r,__plugin_vue_export_helper_default as i,circle_check_default as a,circle_close_default as o,clock_default as s,computed as c,createBaseVNode as l,createBlock as u,createCommentVNode as d,createElementBlock as f,createTextVNode as p,createVNode as m,defineComponent as h,getAgentStageStateColor as g,getStatusColor as _,loading_default as v,normalizeClass as y,normalizeStyle as b,onMounted as x,openBlock as S,ref as C,renderList as w,resolveDirective as T,resolveDynamicComponent as E,toDisplayString as D,unref as O,useMasStore as k,useModalStore as A,withCtx as j,withDirectives as M}from"./index-RFCbVEpM.js";import{DetailButton_default as N,SkeletonLoader_default as P}from"./SkeletonLoader-CHrQVRRe.js";import{StatusIndicator_default as F}from"./StatusIndicator-wAaoQJpk.js";const I={class:`task-info-card`},L={class:`task-name`},R={class:`task-intention`};var z=h({__name:`TaskInfoCard`,props:{task:{}},emits:[`detail-click`],setup(t){let r=e=>{let t={init:s,pending:s,running:v,finished:a,failed:o};return t[e]||s},i=e=>{let t={init:`init`,pending:`pending`,running:`running`,finished:`finished`,failed:`failed`};return t[e]||e};return(t,a)=>{let o=e,s=n,c=T(`tooltip-overflow`),d=T(`markdown`);return S(),f(`div`,I,[m(s,{content:i(t.task.execution_state),placement:`top`},{default:j(()=>[l(`div`,{class:y([`task-status-indicator`,`status-${t.task.execution_state}`])},[m(o,null,{default:j(()=>[(S(),u(E(r(t.task.execution_state))))]),_:1})],2)]),_:1},8,[`content`]),M((S(),f(`div`,L,[p(D(t.task.task_name),1)])),[[c]]),M(l(`div`,R,null,512),[[d,t.task.task_intention||`æš‚æ— æè¿°`]]),m(N,{text:`å®Œæ•´ä¿¡æ¯`,theme:`red`,onClick:a[0]||=e=>t.$emit(`detail-click`,t.task)})])}}}),B=i(z,[[`__scopeId`,`data-v-4cbc0c7c`]]);const V={class:`stage-flip-card-face stage-flip-card-front`},H={class:`stage-flip-card-face stage-flip-card-back`},U={key:0,class:`stage-expanded`},W={class:`agent-collaboration`},G=[`onClick`],K={key:0,class:`agent-basic`},q={key:1,class:`agent-detail-expanded`},J={class:`agent-detail-header`},Y={class:`agent-name`},X={class:`agent-allocation-content`};var Z=h({__name:`StageCard`,props:{stage:{}},emits:[`detail-click`],setup(e){let t=e,n=k(),i=C(!1),a=C(!1),o=C(null),s=C(),h=c(()=>({backgroundColor:_(t.stage.execution_state)})),v=()=>{s.value&&clearTimeout(s.value),i.value=!0},x=()=>{s.value=setTimeout(()=>{i.value=!1,a.value=!1,o.value=null},3e4)},E=e=>{e.stopPropagation(),a.value=!a.value},A=e=>{if(o.value===e){j();return}o.value=e},j=()=>{o.value=null},P=e=>{let t=n.getAgentById(e);return t?`[${t.role}] ${t.name}`:`Agent ${e.slice(0,8)}...`};return(e,t)=>{let n=T(`markdown`);return S(),f(`div`,{class:y([`stage-flip-card`,{flipped:i.value}]),onMouseenter:v,onMouseleave:x},[l(`div`,V,[i.value?d(``,!0):(S(),f(`div`,{key:0,class:`stage-compact`,style:b(h.value)},null,4))]),l(`div`,H,[i.value?(S(),f(`div`,U,[m(F,{status:e.stage.execution_state,tooltip:e.stage.execution_state},null,8,[`status`,`tooltip`]),l(`div`,{class:`stage-intention`,onClick:E},[M(l(`div`,{class:y(a.value?`intention-expanded`:`intention-basic`)},null,2),[[n,e.stage.stage_intention]])]),l(`div`,W,[(S(!0),f(r,null,w(e.stage.every_agent_state,(n,r)=>(S(),f(`div`,{key:r,class:`agent-block`,style:b({backgroundColor:O(g)(n)}),onClick:e=>A(r)},[o.value===r?(S(),f(`div`,q,[l(`div`,J,[l(`div`,Y,D(P(r)),1)]),l(`div`,X,[t[1]||=l(`strong`,null,`åˆ†é…ç›®æ ‡ï¼š`,-1),p(` `+D(e.stage.agent_allocation[r]||`æ— åˆ†é…ç›®æ ‡`),1)])])):(S(),f(`div`,K,D(P(r)),1))],12,G))),128))])])):d(``,!0),i.value?(S(),u(N,{key:1,theme:`purple`,sizeType:`small`,onClick:t[0]||=t=>e.$emit(`detail-click`,e.stage)})):d(``,!0)])],34)}}}),Q=i(Z,[[`__scopeId`,`data-v-f7ba2f25`]]);const $={class:`stage-view`},ee={key:0,class:`loading-container`},te={key:1,class:`empty-state`},ne={key:2},re={class:`stage-list`};var ie=h({__name:`StageView`,setup(e){let n=k(),i=A(),a=C(!1),o=c(()=>n.groupStagesByTask()),s=C(),d=async()=>{a.value=!0;try{await Promise.all([n.getStages(),n.getTask(),n.getAgents()])}catch(e){t.error(`è·å–æ•°æ®å¤±è´¥`),console.error(`Failed to refresh data:`,e)}finally{a.value=!1}};x(async()=>{await d()});let p=e=>{console.log(`æ‰“å¼€Taskè¯¦æƒ…:`,e),i.createModal({type:`task`,title:`Taskè¯¦æƒ… - ${e.task_name}`,id:e.task_id,data:e,slots:{default:`TaskInfo`},componentProps:{taskData:e}})},h=e=>{console.log(`æ‰“å¼€Stageè¯¦æƒ…:`,e),i.createModal({type:`stage`,title:`Stageè¯¦æƒ… - ${e.stage_id}`,id:e.stage_id,data:e,slots:{default:`StageInfo`},componentProps:{stageData:e}})};return(e,t)=>(S(),f(`div`,$,[a.value?(S(),f(`div`,ee,[m(P,{type:`stage`,count:3})])):o.value.length?(S(),f(`div`,ne,[(S(!0),f(r,null,w(o.value,(e,t)=>(S(),f(`div`,{key:e.taskId,class:`task-row`,style:b({animationDelay:`${.1+t*.1}s`})},[m(B,{task:e.task,class:`task-info-fixed`,onDetailClick:p},null,8,[`task`]),l(`div`,{class:`stage-list-container`,ref_for:!0,ref_key:`stageContainer`,ref:s},[l(`div`,re,[(S(!0),f(r,null,w(e.stages,(e,t)=>(S(),u(Q,{key:e.stage_id,stage:e,class:y({"animate-stage":!0}),style:b({animationDelay:`${.3+t*.05}s`}),onDetailClick:h},null,8,[`stage`,`style`]))),128))])],512)],4))),128))])):(S(),f(`div`,te,[t[0]||=l(`div`,{class:`empty-icon`},`ğŸ“‹`,-1),t[1]||=l(`div`,{class:`empty-text`},[l(`h3`,null,`æš‚æ— é˜¶æ®µæ•°æ®`),l(`p`,null,`å½“å‰æ²¡æœ‰å¯æ˜¾ç¤ºçš„é˜¶æ®µä¿¡æ¯ï¼Œè¯·æ£€æŸ¥æ•°æ®è¿æ¥æˆ–ç¨åé‡è¯•ã€‚`)],-1),l(`button`,{onClick:d,class:`refresh-button`},`åˆ·æ–°æ•°æ®`)]))]))}}),ae=i(ie,[[`__scopeId`,`data-v-5a8d99de`]]);export{ae as default};